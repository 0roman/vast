#!/bin/sh

export CC=${CC:-"gcc-8"}
export CXX=${CXX:-"g++"}
export BUILD_TYPE=${BUILD_TYPE:-"Local"}
export PACKAGE_NAME=${PACKAGE_NAME:-"VAST-$(git describe)-$(uname -s)-$BUILD_TYPE"}
export PREFIX=${PREFIX:-"./opt/tenzir"}
mkdir -p "$PREFIX"

if [ -n "$GITHUB_ACTION" ]; then
  echo Preparing for CI build...
  echo "$PACKAGE_NAME" > PACKAGE_NAME
  ARTIFACT_NAME="VAST-${GITHUB_REF#refs/heads/}-$(uname -s)-$BUILD_TYPE-$(git rev-parse --short HEAD)"
  export ARTIFACT_NAME
  echo "$ARTIFACT_NAME" > ARTIFACT_NAME
  echo "$MULE_SSH_KEY" | base64 --decode > mule_ssh_key && chmod 600 mule_ssh_key
  echo "$CONFIGURE_FLAGS" > CONFIGURE_FLAGS
fi

# print versions
echo Build type: "$BUILD_TYPE"
echo Package name: "$PACKAGE_NAME"
cmake --version
${CXX} --version
python --version
